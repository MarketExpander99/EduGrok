{% extends "base.html.j2" %}

{% block content %}
<h2 class="text-2xl font-semibold mb-4">Your Profile, Dino Cowboy!</h2>

{% if user %}
    <div class="lesson-card">
        <h3>User Info</h3>
        <p><strong>Handle:</strong> {{ user.handle | default('User') }}</p>
        <p><strong>Grade:</strong> {{ grade }}</p>
        <p><strong>Star Coins:</strong> {{ star_coins | default(0) }}</p>
        <p><strong>Points:</strong> {{ points | default(0) }}</p>
    </div>

    <div class="lesson-card">
        <h3>Progress</h3>
        <p><strong>Lessons Completed:</strong> {{ lessons_completed }}</p>
        <p><strong>Games Played:</strong> {{ games_played }}</p>
        <p><strong>Average Test Score:</strong> {{ avg_score }}</p>
    </div>

    <div class="lesson-card">
        <h3>Badges</h3>
        {% if badges %}
            {% for badge in badges %}
                <span class="badge">{{ badge.badge_name }} ({{ badge.awarded_date }})</span>
            {% endfor %}
        {% else %}
            <p>No badges yet. Keep learning to earn some!</p>
        {% endif %}
    </div>

    <div class="lesson-card">
        <h3>Feedback History</h3>
        {% if feedbacks %}
            {% for feedback in feedbacks %}
                <p><strong>Rating:</strong> {{ feedback.rating }} - <strong>Comments:</strong> {{ feedback.comments | default('None') }} - <strong>Date:</strong> {{ feedback.submitted_date }}</p>
            {% endfor %}
        {% else %}
            <p>No feedback submitted yet. <a href="{{ url_for('feedback') }}" class="btn-primary">Submit Feedback</a></p>
        {% endif %}
    </div>

    <div class="lesson-card">
        <h3>Settings</h3>
        <form action="{{ url_for('set_theme') }}" method="POST" class="mb-4">
            <label for="theme" class="block mb-2">Theme:</label>
            <select name="theme" id="theme" class="p-2 border rounded">
                <option value="astronaut" {% if theme == 'astronaut' %}selected{% endif %}>Astronaut</option>
                <option value="farm" {% if theme == 'farm' %}selected{% endif %}>Farm</option>
            </select>
            <button type="submit" class="btn-primary mt-2">Update Theme</button>
        </form>
        <form action="{{ url_for('set_language') }}" method="POST">
            <label for="language" class="block mb-2">Language:</label>
            <select name="language" id="language" class="p-2 border rounded">
                <option value="en" {% if language == 'en' %}selected{% endif %}>English</option>
                <option value="bilingual" {% if language == 'bilingual' %}selected{% endif %}>Bilingual (English/Afrikaans)</option>
            </select>
            <button type="submit" class="btn-primary mt-2">Update Language</button>
        </form>
    </div>
{% else %}
    <div class="lesson-card">
        <p class="text-red-500">Unable to load user information. Please <a href="{{ url_for('login') }}" class="btn-primary">log in again</a>.</p>
    </div>
{% endif %}
{% endblock %}