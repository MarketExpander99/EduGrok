{% extends "base.html.j2" %}

{% block content %}
<h2 class="text-2xl font-semibold mb-4">Create a Post</h2>
<form action="{{ url_for('create_post') }}" method="POST" class="mb-6">
    <textarea name="content" class="w-full p-2 border rounded" placeholder="Share something..." required></textarea>
    <select name="subject" class="p-2 border rounded">
        <option value="math">Math</option>
        <option value="science">Science</option>
        <option value="language">Language</option>
        <option value="General">General</option>
    </select>
    <button type="submit" class="btn-success">Post</button>
</form>

{% if posts %}
    {% for post in posts %}
        <div class="bg-white p-4 rounded-xl shadow-lg border border-blue-200 hover:-translate-y-1 hover:shadow-xl transition max-w-lg mx-auto mb-4">
            <div class="flex items-center mb-2">
                <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center mr-3 font-bold">
                    {{ post.handle[0] | upper }}
                </div>
                <h3 class="text-sm font-semibold text-blue-900">{{ post.handle }} (Grade {{ post.grade }}) - {{ post.created_at }}</h3>
            </div>
            <p class="text-gray-800 leading-relaxed mb-2">{{ post.content }}</p>
            <div class="flex flex-wrap gap-2 mb-2">
                <span class="bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded-full">Subject: {{ post.subject }}</span>
                <span class="bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded-full">Likes: {{ post.likes }}</span>
            </div>
            <form action="{{ url_for('like_post', post_id=post.id) }}" method="POST" class="flex justify-end">
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition" {% if post.liked_by_user %}disabled{% endif %}>
                    {{ 'Unlike' if post.liked_by_user else 'Like' }}
                </button>
            </form>
        </div>
    {% endfor %}
{% else %}
    <p>No posts available.</p>
{% endif %}

{% if lesson %}
    <div class="bg-yellow-100 p-4 rounded-xl shadow-lg border border-orange-300 hover:-translate-y-1 hover:shadow-xl transition max-w-lg mx-auto mb-4">
        <h3 class="text-sm font-semibold text-orange-900 mb-2">{{ lesson.subject }}</h3>
        <div class="text-gray-800 leading-relaxed mb-2">{{ lesson.content | safe }}</div>
        <div class="flex justify-end">
            <a href="{{ url_for('complete_lesson', lesson_id=lesson.id) }}" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">Complete Lesson</a>
        </div>
    </div>
{% else %}
    <p>No lessons available. Try generating a new one!</p>
{% endif %}

<h2 class="text-2xl font-semibold mt-6 mb-4">Recent Test</h2>
{% if test %}
    <p>Grade {{ test.grade }} - Score: {{ test.score }} - Date: {{ test.date }}</p>
{% else %}
    <p>No tests taken yet.</p>
{% endif %}
{% endblock %}