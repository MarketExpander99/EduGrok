{% extends "base.html.j2" %}

{% block content %}
<h2 class="text-2xl font-semibold mb-4">Create a Post</h2>
<form action="{{ url_for('create_post') }}" method="POST" class="mb-6">
    <textarea name="content" class="w-full p-2 border rounded" placeholder="Share something..." required></textarea>
    <select name="subject" class="p-2 border rounded">
        <option value="math">Math</option>
        <option value="science">Science</option>
        <option value="language">Language</option>
        <option value="General">General</option>
    </select>
    <button type="submit" class="btn-success">Post</button>
</form>

<h2 class="text-2xl font-semibold mb-4">Recent Posts</h2>
{% if posts %}
    {% for post in posts %}
        <div class="post-card">
            <p><strong>{{ post.handle }}</strong> (Grade {{ post.grade }}) - {{ post.created_at }}</p>
            <p>{{ post.content }}</p>
            <p>Subject: {{ post.subject }}</p>
            <p>Likes: {{ post.likes }}</p>
            <form action="{{ url_for('like_post', post_id=post.id) }}" method="POST">
                <button type="submit" class="btn-primary" {% if post.liked_by_user %}disabled{% endif %}>
                    {{ 'Unlike' if post.liked_by_user else 'Like' }}
                </button>
            </form>
        </div>
    {% endfor %}
{% else %}
    <p>No posts available.</p>
{% endif %}

<h2 class="text-2xl font-semibold mt-6 mb-4">Next Lesson</h2>
{% if lesson %}
    <div class="lesson-card">
        <h3>{{ lesson.subject }}</h3>
        <div>{{ lesson.content | safe }}</div>
        <a href="{{ url_for('complete_lesson', lesson_id=lesson.id) }}" class="btn-primary">Complete Lesson</a>
    </div>
{% else %}
    <p>No lessons available. Try generating a new one!</p>
{% endif %}

<h2 class="text-2xl font-semibold mt-6 mb-4">Recent Test</h2>
{% if test %}
    <p>Grade {{ test.grade }} - Score: {{ test.score }} - Date: {{ test.date }}</p>
{% else %}
    <p>No tests taken yet.</p>
{% endif %}
{% endblock %}